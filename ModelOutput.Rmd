---
title: "Plotting Model Output"
output: html_notebook
---

```{r}
library(tidyverse)
library(gghighlight)
library(purrr)
```


# Read in model output files


```{r}

#locations=c('London','Sheffield','Birmingham','Cardiff')

#pathname='Locations'
pathname = 'Testing'
dir(pathname,pattern='TotalInfections.dat',recursive=TRUE)->infectionfiles

readinfections<-function (fname,fpath){        
#  Function to read in TotalInfections.dat' type files (one column only of infecteds, Time is row number)
  d<-read_csv(file.path(fpath,fname),col_names=FALSE,cols(X1=col_integer())) %>% # 
    mutate(Time=row_number()) %>% 
    select(Time,Infecteds=X1)
   return(d)
}
  
data <- tibble(filename = infectionfiles) %>% # create a data frame
                                                  # holding the file names
  mutate(file_contents = map(filename,            # read files into a new data column
                             ~readinfections(., pathname))) %>% # use the function written above to process files
  mutate(Location=str_split(filename,'/',simplify = TRUE)[,1]) %>% 
  mutate(Run=str_split(filename,'/',simplify = TRUE)[,2]) %>% 
  select(-filename) %>% 
  unnest(cols=file_contents)
  

```



```{r}
library(cowplot)
library(scales)
data %>%
  mutate(Infected=Infecteds/10^6) %>% 
  filter(Time<180) %>% 
  ggplot(aes(x=Time,y=Infected,colour=Run))+
  geom_line()+
  gghighlight()+
#  facet_wrap(~Location)+
  theme_minimal_grid()+
  theme(strip.text.x = element_blank())+
  scale_y_continuous(labels = unit_format(unit = "M"))+
  xlab('Time (days)')


```




# Number of Infected Wards

```{r}

read.csv(file='NumberWardsInfected.dat',sep=' ') %>% 
  mutate(Time=X0) %>% 
  select(-X,-X0,-X0.4) ->wardcurves


wardcurves %>% 
  pivot_longer(-Time,names_to = 'Classes',values_to = 'NumberWards')%>% 
  ggplot(aes(x=Time,y=NumberWards,colour=Classes))+
  geom_line()
```






```{r}


read.csv(file='London/TotalInfections.dat') %>% 
  transmute(Time=row_number(),L1=X0)->epicurveL

which.max(epicurveL$L1)

read.csv(file='London2/TotalInfections.dat') %>% 
  transmute(Time=row_number(),L2=X0)->epicurveL2

which.max(epicurveL2$L2)

read.csv(file='Testing/TotalInfections.dat') %>% 
  transmute(Time=row_number(),LShorter=X0)->epicurveShorter

which.max(epicurveShorter$LShorter)


epicurveL %>% 
  full_join(.,epicurveL2,by='Time') %>% 
  full_join(.,epicurveShorter,by='Time') %>% 
  pivot_longer(-Time) %>% 
  ggplot(aes(x=Time,y=value,colour=name))+
  geom_line()


```


# Epi curves per class

```{r}

read.csv(file='WorkInfections.dat',sep=' ') %>% 
  select(Time=X0,X0.1,X0.2,X0.3)->workinf

read.csv(file='PlayInfections.dat',sep=' ') %>% 
  select(Time=X0,X0.1,X0.2,X0.3)->playinf


workinf %>% 
  pivot_longer(-Time,names_to = 'Classes',values_to = 'NumberInfected')%>% 
  ggplot(aes(x=Time,y=NumberInfected,colour=Classes))+
  geom_line()+
  ylab('Number of cases')+
  scale_y_log10()


```

